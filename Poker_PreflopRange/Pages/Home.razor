@page "/"
@using System.Timers

<PageTitle>Poker Preflop Range Trainer</PageTitle>

<div class="poker-game-container">
    <h1>BTN Preflop Range Trainer</h1>
    <p class="game-instructions">Should these cards be played from the Button (BTN) position?</p>
    
    <div class="cards-container">
        <div class="card @GetCardClass(CurrentCard1)">
            @GetCardDisplay(CurrentCard1)
        </div>
        <div class="card @GetCardClass(CurrentCard2)">
            @GetCardDisplay(CurrentCard2)
        </div>
    </div>
    
    <div class="hand-name">
        <h3>@GetHandName()</h3>
    </div>
    
    <div class="buttons-container">
        <button class="btn game-btn @GetButtonClass("Yes")" 
                @onclick="() => AnswerQuestion(true)" 
                disabled="@IsAnswering">
            Yes
        </button>
        <button class="btn game-btn @GetButtonClass("No")" 
                @onclick="() => AnswerQuestion(false)" 
                disabled="@IsAnswering">
            No
        </button>
    </div>
    
    <div class="score-container">
        <p>Score: @CorrectAnswers / @TotalAnswers (@(TotalAnswers > 0 ? Math.Round((double)CorrectAnswers / TotalAnswers * 100, 1) : 0)%)</p>
    </div>
</div>

<style>
    .poker-game-container {
        text-align: center;
        padding: 2rem;
        max-width: 600px;
        margin: 0 auto;
    }
    
    .game-instructions {
        font-size: 1.2rem;
        margin-bottom: 2rem;
        color: #666;
    }
    
    .cards-container {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .card {
        width: 120px;
        height: 168px;
        border: 2px solid #333;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
        font-weight: bold;
        background: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }
    
    .card.red {
        color: #dc3545;
    }
    
    .card.black {
        color: #333;
    }
    
    .hand-name {
        margin-bottom: 2rem;
    }
    
    .hand-name h3 {
        font-size: 1.8rem;
        font-weight: bold;
        color: #333;
    }
    
    .buttons-container {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .game-btn {
        padding: 1rem 2rem;
        font-size: 1.5rem;
        font-weight: bold;
        border-radius: 8px;
        min-width: 120px;
        transition: all 0.3s ease;
    }
    
    .game-btn:not(:disabled):hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }
    
    .game-btn.btn-correct {
        background-color: #28a745 !important;
        border-color: #28a745 !important;
        color: white !important;
    }
    
    .game-btn.btn-incorrect {
        background-color: #dc3545 !important;
        border-color: #dc3545 !important;
        color: white !important;
    }
    
    .score-container {
        font-size: 1.2rem;
        font-weight: bold;
        color: #333;
    }
</style>

@code {
    // Card representation
    public class Card
    {
        public string Rank { get; set; } = "";
        public string Suit { get; set; } = "";
        public bool IsRed => Suit == "♥" || Suit == "♦";
    }
    
    // Game state
    private Card CurrentCard1 = new();
    private Card CurrentCard2 = new();
    private Random random = new();
    private bool IsAnswering = false;
    private string LastAnswer = "";
    private int CorrectAnswers = 0;
    private int TotalAnswers = 0;
    
    // Button range - hands that should be played from BTN position
    private readonly HashSet<string> ButtonRange = new()
    {
        // Pairs
        "AA", "KK", "QQ", "JJ", "TT", "99", "88", "77", "66", "55", "44", "33", "22",
        
        // Suited Aces
        "AKs", "AQs", "AJs", "ATs", "A9s", "A8s", "A7s", "A6s", "A5s", "A4s", "A3s", "A2s",
        
        // Suited Kings
        "KQs", "KJs", "KTs", "K9s", "K8s", "K7s", "K6s", "K5s", "K4s", "K3s", "K2s",
        
        // Suited Queens
        "QJs", "QTs", "Q9s", "Q8s", "Q7s", "Q6s", "Q5s", "Q4s", "Q3s", "Q2s",
        
        // Suited Jacks
        "JTs", "J9s", "J8s", "J7s", "J6s", "J5s", "J4s", "J3s", "J2s",
        
        // Suited Tens
        "T9s", "T8s", "T7s", "T6s", "T5s", "T4s", "T3s", "T2s",
        
        // Other suited
        "98s", "97s", "96s", "95s", "94s", "93s", "92s",
        "87s", "86s", "85s", "84s", "83s", "82s",
        "76s", "75s", "74s", "73s", "72s",
        "65s", "64s", "63s", "62s",
        "54s", "53s", "52s",
        "43s", "42s",
        "32s",
        
        // Offsuit Aces
        "AKo", "AQo", "AJo", "ATo", "A9o", "A8o", "A7o", "A6o", "A5o", "A4o", "A3o", "A2o",
        
        // Offsuit Kings
        "KQo", "KJo", "KTo", "K9o", "K8o", "K7o", "K6o", "K5o", "K4o", "K3o", "K2o",
        
        // Offsuit Queens
        "QJo", "QTo", "Q9o", "Q8o", "Q7o", "Q6o", "Q5o", "Q4o", "Q3o", "Q2o",
        
        // Offsuit Jacks
        "JTo", "J9o", "J8o", "J7o", "J6o", "J5o", "J4o", "J3o", "J2o",
        
        // Offsuit Tens
        "T9o", "T8o", "T7o", "T6o", "T5o", "T4o", "T3o", "T2o",
        
        // Other offsuit
        "98o", "97o", "96o", "95o", "94o", "93o", "92o",
        "87o", "86o", "85o", "84o", "83o", "82o",
        "76o", "75o", "74o", "73o", "72o",
        "65o", "64o", "63o", "62o",
        "54o", "53o", "52o",
        "43o", "42o",
        "32o"
    };
    
    protected override void OnInitialized()
    {
        GenerateNewHand();
    }
    
    private void GenerateNewHand()
    {
        var ranks = new[] { "A", "K", "Q", "J", "T", "9", "8", "7", "6", "5", "4", "3", "2" };
        var suits = new[] { "♠", "♥", "♦", "♣" };
        
        // Generate two different cards
        do
        {
            CurrentCard1 = new Card
            {
                Rank = ranks[random.Next(ranks.Length)],
                Suit = suits[random.Next(suits.Length)]
            };
            
            CurrentCard2 = new Card
            {
                Rank = ranks[random.Next(ranks.Length)],
                Suit = suits[random.Next(suits.Length)]
            };
        } while (CurrentCard1.Rank == CurrentCard2.Rank && CurrentCard1.Suit == CurrentCard2.Suit);
        
        StateHasChanged();
    }
    
    private string GetCardDisplay(Card card)
    {
        return $"{card.Rank}{card.Suit}";
    }
    
    private string GetCardClass(Card card)
    {
        return card.IsRed ? "red" : "black";
    }
    
    private string GetHandName()
    {
        var card1Rank = CurrentCard1.Rank;
        var card2Rank = CurrentCard2.Rank;
        var suited = CurrentCard1.Suit == CurrentCard2.Suit;
        
        // Convert rank to numeric value for comparison
        var getRankValue = (string rank) => rank switch
        {
            "A" => 14,
            "K" => 13,
            "Q" => 12,
            "J" => 11,
            "T" => 10,
            _ => int.Parse(rank)
        };
        
        var rank1Value = getRankValue(card1Rank);
        var rank2Value = getRankValue(card2Rank);
        
        // Ensure higher rank comes first
        if (rank1Value < rank2Value)
        {
            (card1Rank, card2Rank) = (card2Rank, card1Rank);
        }
        
        // Handle pairs
        if (card1Rank == card2Rank)
        {
            return $"{card1Rank}{card2Rank}";
        }
        
        // Handle non-pairs
        var suffix = suited ? "s" : "o";
        return $"{card1Rank}{card2Rank}{suffix}";
    }
    
    private async Task AnswerQuestion(bool playerAnswer)
    {
        if (IsAnswering) return;
        
        IsAnswering = true;
        LastAnswer = playerAnswer ? "Yes" : "No";
        TotalAnswers++;
        
        var handName = GetHandName();
        var correctAnswer = ButtonRange.Contains(handName);
        var isCorrect = playerAnswer == correctAnswer;
        
        if (isCorrect)
        {
            CorrectAnswers++;
        }
        
        StateHasChanged();
        
        // Wait 1 second to show the result
        await Task.Delay(1000);
        
        // Reset and generate new hand
        IsAnswering = false;
        LastAnswer = "";
        GenerateNewHand();
    }
    
    private string GetButtonClass(string buttonText)
    {
        if (!IsAnswering || LastAnswer != buttonText) 
            return "btn-primary";
            
        var handName = GetHandName();
        var correctAnswer = ButtonRange.Contains(handName);
        var playerAnsweredYes = buttonText == "Yes";
        var isCorrect = playerAnsweredYes == correctAnswer;
        
        return isCorrect ? "btn-correct" : "btn-incorrect";
    }
}
